<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EnergiMap - Peta Panel Surya & Energi Terbarukan</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f8f9fa;
    }
    h2 {
      text-align: center;
      background: #0077b6;
      color: white;
      padding: 10px;
      margin: 0;
    }
    #map {
      height: 90vh;
      width: 100%;
    }
    .leaflet-popup-content {
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h2>EnergiMap ⚡ – Peta Panel Surya & Potensi Energi Terbarukan</h2>
  <div id="map"></div>

  <script>
    // Inisialisasi peta
    var map = L.map('map').setView([-6.9055, 106.8733], 13);

    // --- Base Maps ---
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap'
    }).addTo(map);

    var satellite = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
      {
        maxZoom: 19,
        attribution: 'Tiles © Esri'
      }
    );

    // --- Overlay Layers ---
    var solarLayer = L.layerGroup();
    var gridLayer = L.layerGroup();
    var potentialLayer = L.layerGroup();

    // Fungsi umum untuk bind popup
    function onEachFeature(feature, layer) {
      if (feature.properties && feature.properties.name) {
        layer.bindPopup(`
          <b>${feature.properties.name}</b><br>
          <small>${feature.properties.info || 'Data tidak tersedia'}</small>
        `);
      }
    }

    // Load Marker Lokasi Panel Surya (GeoJSON)
    fetch('panel_surya.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {
              icon: L.icon({
                iconUrl: 'https://cdn-icons-png.flaticon.com/512/8045/8045526.png',
                iconSize: [32, 32],
                iconAnchor: [16, 32],
                popupAnchor: [0, -28]
              })
            });
          },
          onEachFeature: onEachFeature
        }).addTo(solarLayer);
      });

    // Load Polyline Rute Jaringan Listrik
    fetch('jaringan_listrik.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: { color: 'orange', weight: 3 },
          onEachFeature: onEachFeature
        }).addTo(gridLayer);
      });

    // Load Polygon Wilayah Potensi Energi
    fetch('potensi_energi.geojson')
      .then(res => res.json())
      .then(data => {
        L.geoJSON(data, {
          style: { color: 'green', fillOpacity: 0.3 },
          onEachFeature: onEachFeature
        }).addTo(potentialLayer);
      });

    // --- Layer Control ---
    var baseMaps = {
      "OpenStreetMap": osm,
      "Citra Satelit": satellite
    };

    var overlayMaps = {
      "Lokasi Panel Surya": solarLayer,
      "Rute Jaringan Listrik": gridLayer,
      "Wilayah Potensi Energi": potentialLayer
    };

    L.control.layers(baseMaps, overlayMaps).addTo(map);

    // Tampilkan semua overlay secara default
    solarLayer.addTo(map);
    gridLayer.addTo(map);
    potentialLayer.addTo(map);
  </script>
</body>
</html>
